Updated
-------

The command handler can now be a generator.

Config Magic
------------

    SNAKED          = $(SBIN)/condor_snaked
    SNAKED_LOG      = $(LOG)/SnakeLog
    SNAKE_PATH      = $(LIB)/python3:$(ETC)/snake.d
    DAEMON_LIST     = $(DAEMON_LIST), SNAKED

Further Setup
-------------

Create ``$(ETC)/snake.d/snake/__init__.py`` and fill it with:

    import time
    import classad2
    from pathlib import Path

    def handleCommand(command_int, payload):
        p = Path("/tmp") / "snake.out"
        classAd = payload.get('classad')
        with p.open("a") as f:
            print(
                f"handling command int {command_int}, with classAd payload {classAd}",
                file=f
            )

        reply = classad2.ClassAd()

        reply['MyType'] = "Machine"
        reply['Arch'] = "TurboFake"
        reply['OpSys'] = "LINUX"
        reply['Arch'] = "X86_64"
        reply['Machine'] = "snake-0000"
        reply['Name'] = "slot1_1@snake-0000"
        reply['Memory'] = 1000

        then = int(time.time()) - 20
        reply['EnteredCurrentActivity'] = then
        reply['LastHeadFrom'] = then
        reply['Activity'] = "Idle"
        reply['State'] = "Unclaimed"
        reply['CondorLoadAvg'] = 0.0

        with p.open("a") as f:
            print(
                f"Sending the following as the reply: {reply}",
                file=f
            )
        yield (1, reply)

        with p.open("a") as f:
            print(
                f"Sending the empty 'done' reply",
                file=f
            )
        yield (0, None)


where ``"/tmp"`` is subject to change and ``"handled ..."`` should be,
to make sure I'm not cheating. :)

Demo
----

Run ``condor_master``.  Look at ``SnakeLog``; copy its command socket
sinful.  Run ``condor_status -direct '<sinful>'``; it will fail, but
you should now have a file, ``/tmp/snake.out``, that was generated by the
``handleCommand()`` function.
