NAME = nordugrid_gahp
all_target($(NAME))

#ifndef HAVE_UNSETENV
UNSETENV_LIB = ../condor_c++_util/condor_unsetenv.a
#endif

/* We pick out the specific LIB targets we need to avoid accidently
 * linking against any of the Condor libraries, which we don't want.
 */
CFLAGS = $(STD_C_FLAGS)
LIB = $(PRE_EXT_LIBS) \
	$(UNSETENV_LIB) \
	$(GLOBUS_DIR)/lib/libglobus_rsl_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_ftp_client_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_ftp_control_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_io_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_xio_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_gssapi_error_$(GlobusFlavor).a \
	$(GSI_LIB) -lldap $(OPENSSL_LIB) $(POST_EXT_LIBS)
STATIC_LIB = $(PRE_EXT_LIBS) \
	$(GLOBUS_DIR)/lib/libglobus_rsl_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_ftp_client_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_ftp_control_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_io_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_xio_$(GlobusFlavor).a \
	$(GLOBUS_DIR)/lib/libglobus_gssapi_error_$(GlobusFlavor).a \
	$(GSI_LIB) $(LDAP_LIB) $(OPENSSL_LIB) $(POST_EXT_LIBS)

OBJ = nordugrid_gahp.o globus_ftp_client_transfer.o globus_ftp_client_restart.o globus_ftp_client_state.o

/* Need separate library parameters for dynamic and static links.
 * For static, we need to explicitly include -llber and -lsasl[2]
 * dependencies for -lldap. But doing so for the dynamic link makes
 * the resulting binary less portable. For example, a rhel3 binary
 * will crash on scientific linux 4, due to a difference between
 * libsasl and libsasl2. See gittrac #1383 for details.
 * The lines below are a manual expansion of this
 * public_c_plus_nowrap_target() macro, with different library flags
 * for dynamic and static.
public_c_plus_nowrap_target($(NAME),sbin,$(OBJ),$(LIB))
*/
all_target($(NAME))
c_plus_nowrap_target($(NAME),$(OBJ),$(LIB))
release_target($(NAME),sbin,EXECUTABLE_MODE)
strip_target($(NAME),sbin,EXECUTABLE_MODE)
static_nowrap_target($(NAME),$(OBJ),$(STATIC_LIB),sbin)

testbin::
