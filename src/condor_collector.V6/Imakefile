NAME = condor_collector
all_target(collector_engine.a $(NAME))

CFLAGS = $(STD_C_FLAGS) $(CONFIGURE_PCRE_CFLAGS)
C_PLUS_FLAGS = $(STD_C_PLUS_FLAGS) $(CONFIGURE_PCRE_CFLAGS)
LIB = collector_engine.a $(SOAP_LIB) $(DAEMONCORE_LIB) $(STD_LIBS) $(CONFIGURE_GSOAP_LDFLAGS) $(CONFIGURE_PCRE_LDFLAGS)

ENGINE_OBJ = hashkey.o collector_engine.o

#if HAVE_DLOPEN
# define PluginObj CollectorPluginManager.o offline_plugin.o
#else
# define PluginObj
#endif

%-plugin.so: %.cpp
	$(CPlusPlus) $(C_PLUS_FLAGS) -shared $< -o $@

soapobjs(collector)

OBJ = $(SOAP_OBJS) \
      collector_main.o collector.o view_server.o \
       totals.o collector_stats.o PluginObj ccb_server.o

library_target(collector_engine.a, $(ENGINE_OBJ))

public_c_plus_target($(NAME),sbin,$(OBJ),$(LIB))

IMPORT_LINKS = ../../config/import_links
import_objs(../condor_status.V6,totals.o)
import_objs(../ccb,ccb_server.o)

gen_soapfiles(collector,condorCollector)

html:
testbin:: all
