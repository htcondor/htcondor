%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\label{sec:Condor-G-GridMonitor}The Grid Monitor}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{grid computing!Grid Monitor}
\index{scalability!using the Grid Monitor}

Condor's Grid Monitor is designed to improve the scalability of
machines running Globus GT2 gatekeepers.
Normally, a Globus GT2 gatekeeper runs a jobmanager process for 
every job submitted to the gatekeeper.
This includes both currently running jobs and jobs waiting in the queue.
Each jobmanager runs a Perl script at
frequent intervals (every 10 seconds) to poll the state of its job in the local batch system.
For example, with 400 jobs submitted to a gatekeeper,
there will be 400 jobmanagers running,
each regularly starting a Perl script.
When a large number of jobs
have been submitted to a single gatekeeper,
this frequent polling can heavily load the gatekeeper.
When the gatekeeper is under heavy load,
the system can become non-responsive and a variety of problems can occur.

Condor's Grid Monitor temporarily replaces these jobmanagers.
It is named the Grid Monitor, because it replaces the monitoring
(polling) duties previously done by jobmanagers.
When the Grid Monitor is enabled,
Condor attempts to start a single
process to poll all of a user's jobs at a given gatekeeper.
While the job is waiting in the queue, but not yet running,
Condor shuts down the associated jobmanager and instead
relies on the Grid Monitor to report changes in status.
The jobmanager will have been started to add the job to the remote
batch system queue, then be shut down.
The jobmanager will restart when the job begins running.

By default, standard output and standard error are streamed back
to the submitter while the job is running.
To support this, the jobmanager must be running.
As a result, the Grid Monitor cannot
replace the jobmanager for running jobs that use streaming.
If you disable streaming for your job,
the Grid Monitor can be used while the job is running.
If you do not need file streaming, this setting is strongly recommended.
File streaming is enabled or disabled on a job-by-job basis.
To disable file streaming for a given job, place the
following lines in the job's submit description file:

\begin{verbatim}
stream_output = False
stream_error  = False
\end{verbatim}

The Grid Monitor requires that the gatekeeper support the fork
jobmanager with the name \Prog{jobmanager-fork}.
If the gatekeeper does not support the fork jobmanager,
the Grid Monitor will not be used for that site.
The \Condor{gridmanager} log file reports any problems
using the Grid Monitor.

To enable the Grid Monitor,
two variables are added to the Condor configuration file.
The configuration macro \Macro{GRID\_MONITOR}
is already present in current distributions of Condor,
but it may be missing from earlier versions of Condor.
Also set the configuration macro \Macro{ENABLE\_GRID\_MONITOR}
to \Expr{True}.

\begin{verbatim}
GRID_MONITOR        = $(SBIN)/grid_monitor.sh
ENABLE_GRID_MONITOR = TRUE
\end{verbatim}

