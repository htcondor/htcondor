%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\label{sec:Windows-Install}Installation on Windows}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{installation!Windows|(}
\index{Windows!installation|(}
This section contains the instructions for installing the Microsoft
Windows version of Condor at your site.  
The install program will set you up with a slightly customized configuration
file that you can further customize after the installation has completed.

Please read the copyright and disclaimer information in 
section~\ref{sec:copyright-and-disclaimer} on
page~\pageref{sec:copyright-and-disclaimer} of the manual, or in the
file 
\File{LICENSE.TXT}, before proceeding.  Installation and
use of Condor is acknowledgement that you have read and agreed to these
terms.

Be sure that the Condor tools that get run are of the same version
as the daemons installed.
If they were not (such as 6.5.3 daemons, when running 6.4 \Condor{submit}),
then things will not work.
There may be errors generated by the \Condor{schedd} daemon (in the log).
It is likely that a job would be correctly placed in the queue,
but the job will never run.

The Condor executable for distribution is packaged in
a single file such as:
\begin{verbatim}
  condor-6.6.0-winnt40-x86.exe
\end{verbatim}

\index{Windows!installation!initial file size}
This file is approximately 20 Mbytes in size, and may be
removed once Condor is fully installed.

Before installing Condor, please consider joining the condor-world mailing
list.  Traffic on this list is kept to an absolute minimum.  It is only
used to announce new releases of Condor.
To subscribe, follow the directions given at
\URL{http://www.cs.wisc.edu/condor/mail-lists/}.

\subsubsection{Installation Requirements}

\begin{itemize}

\item Condor for Windows requires Windows 2000 (or better) or Windows XP.

\item 50 megabytes of free disk space is recommended.  Significantly more 
disk space could be desired to be able to run jobs with large data files.

\item Condor for Windows will operate on either an NTFS or FAT filesystem.  However, for security purposes, NTFS is preferred.

\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{\label{sec:NT-Preparing-to-Install}Preparing to Install
Condor under Windows } 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{Windows!installation!preparation}
Before you install the Windows version of Condor at your site,
there are two major
decisions to make about the basic layout of your pool.

\begin{enumerate}
\item What machine will be the central manager?
\item Do I have enough disk space for Condor?
\end{enumerate}

If you feel that you already know the answers to these questions,
skip to the Windows Installation Procedure section below,
section~\ref{sec:nt-install-procedure} on
page~\pageref{sec:nt-install-procedure}.
If you are unsure, read on.

\begin{itemize} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item{What machine will be the central manager?}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

One machine in your pool must be the central manager.
This is the
centralized information repository for the Condor pool and is also the
machine that matches available machines with waiting
jobs.  If the central manager machine crashes, any currently active
matches in the system will keep running, but no new matches will be
made.  Moreover, most Condor tools will stop working.  Because of the
importance of this machine for the proper functioning of Condor, we
recommend you install it on a machine that is likely to stay up all the
time, or at the very least, one that will be rebooted quickly if it
does crash.  Also, because all the services will send updates (by
default every 5 minutes) to this machine, it is advisable to consider
network traffic and your network layout when choosing the central
manager.

For Personal Condor, your machine will act as your central manager.

Install Condor on the central manager before installing
on the other machines within the pool.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item{Do I have enough disk space for Condor?}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{Windows!installation!required disk space}
The Condor release directory takes up a fair amount of space.
The size requirement for the release
directory is approximately 50 Mbytes.

Condor itself, however, needs space to store all of your jobs, and their
input files.  If you will be submitting large amounts of jobs,
you should consider installing Condor on a volume with a large amount
of free space.

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{\label{sec:nt-install-procedure}
Installation Procedure using the included Set Up Program}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% condor MUST be run as local system
% 
%  root == administrator
%  to install, must be running with administrator privileges
%  the kernel runs as == local system

Installation of Condor must be done by a user with administrator privileges.
After installation, the Condor services will be run under the local system account.
When Condor is running a user job, however, it will run that User job with normal user permissions.
Condor will dynamically enable a special account for running Condor
jobs and disable the account when the job is finished or removed from
the machine.

Download Condor, and start the installation process by running the file (or by double clicking on the file).
The Condor installation is completed by answering questions and choosing options within the following steps.


\begin{description}
\item[If Condor is already installed.]

     For upgrade purposes, you may be running the installation of Condor
     after it has been previously installed.
     In this case, a dialog box will appear before the
     installation of Condor proceeds.
     The question asks if you wish to preserve your current
     Condor configuration files.
     Answer yes or no, as appropriate.
	 
	 If you answer yes, your configuration files will not be changed, and you will proceed to the point where the new binaries will be installed.

     If you answer no, then there will be a second question
     that asks if you want to use answers
     given during the previous installation
     as default answers.

\item[STEP 1: License Agreement.]

     The first step in installing Condor
     is a welcome screen and license agreement.
     You are reminded that it is best to run the installation
     when no other Windows programs are running.
	 If you need to close other Windows programs, it is safe to cancel the
	 installation and close them.
     You are asked to agree to the license.
     Answer yes or no.  If you should disagree with the License, the
	 installation will not continue.

     After agreeing to the license terms, the next Window is where 
     fill in your name and company information,
     or use the defaults as given.

\item[STEP 2: Condor Pool Configuration.]

     The Condor installation will require different
     information depending on whether the installer will
	 be creating a new pool, or joining an existing one.

     If you are creating a new pool, the installation program
	 requires that this machine is the central manager.  
     For the creation of a new Condor pool, you will be asked
	 some basic information about your new pool:
     \begin{description}
     \item[Name of the pool]
     \item[hostname] of this machine.
%  Derek hath declared the Statistics not worthy of prime time.
%     \item[Do you want to keep statistics?]
%       Answer yes or no, as appropriate.
%       If yes, then the maximum amount of data accumulated will
%       be 10 Mbytes.
%       A configurable quantity, \Macro{POOL\_HISTORY\_MAX\_STORAGE}
%       sets the maximum amount of data, and it
%       defaults to 10 Mbytes.
%       If no, then the Condor View client will not have data to display.
     \item[Size of pool]
       Condor needs to know if this a Personal Condor installation,
       or if there will be more than one machine in the pool.
\index{Windows!installation!Personal Condor}
\index{Personal Condor}
       A Personal Condor pool
       implies that there is only one machine in the pool.
       For Personal Condor, several of the following
       steps are omitted as noted.
     \end{description}

     If you are joining an existing pool, all the installation program
	 requires is the hostname of the central manager for your pool.

\item[STEP 3: This Machine's Roles.] 

     This step is omitted for the installation of Personal Condor.

     Each machine within a Condor pool may either
     submit jobs or execute submitted jobs, or both
     submit and execute jobs.
     This step allows the installation on this machine
     to choose if the machine will only submit jobs,
     only execute submitted jobs, or both.
     The common case is both, so the default is both.

\item[STEP 4: Where will Condor be installed?]

\index{Windows!installation!location of files}
The next step is where the destination of the Condor files will be
decided.
It is recommended that Condor be installed in the location shown as the default in the dialog box:
\File{C:\Bs Condor}.

Installation on the local disk is chosen for several reasons.

The Condor services run as local system, and within Microsoft Windows, local system has no network privileges.
Therefore, for Condor to operate, Condor should be installed on a local hard drive as opposed to a network drive (file server).

The second reason for installation on the local disk is that
the Windows usage of drive letters has implications for where
Condor is placed.
The drive letter used must be not change, even when different users are
logged in.
Local drive letters do not change under normal operation of Windows.

While it is strongly discouraged, it may be possible to place Condor on a hard drive that is not local,  if a dependency is added to the service control manager
such that Condor starts after the required file services
are available.

%  !! goes in C:/condor   (default)
%  !! advice is really should go on local hard drive,
%  as opposed to a network drive (also called file server)
%  Because,
%    1. Condor runs as local system, and accesses to a network
%      drive can't be authenticated  -- local system has
%      no network privileges.
%    2.  it is likely that you don't have this set up:
%    (and you need it to make it work)
%    you can add a dependency in the service control manager
%    that condor should start after the file services are
%    available
%    3. drive letters are "system-wide"
%    Must have dedicated letter (for all users), that remains
%    intact for all time, or condor won't know where
%    things are and can't get access (without its "letter")


\item[STEP 5: Where is the Java Virtual Machine?]
	While not required, it is possible for Condor to run jobs in the
	Java universe. In order for Condor to have support for java,
	you must supply a path to \verb@java.exe@ on your system. The
	installer will tell you if the path is invalid before proceeding
	to the next step. To disable the Java universe, simply leave
	this field blank.

\item[STEP 6: Where should Condor send e-mail if things go wrong?]

     Various parts of Condor will send e-mail to a Condor administrator
     if something goes wrong and requires human attention.
     You specify the e-mail address and the SMTP relay host
     of this administrator.  Please pay close attention to this email
	 since it will indicate problems in your Condor pool.

\item[STEP 7: The domain.]

% not really used right now.  "Things that suck about NT."
% UNIX has 2 domains:  file system domain and user-ID domain
% NT has only 1:  a combination, and so going back to letter
% drives, things get screwed up.
     This step is omitted for the installation of Personal Condor.

     Enter the machine's accounting (or UID) domain.
	 On this version of Condor for Windows, this setting only used for User
	 priorities (see section~\ref{sec:UserPrio} on
	 page~\pageref{sec:UserPrio}) and to form a default email address for
	 the user.

\item[STEP 8: Access permissions.]
     This step is omitted for the installation of Personal Condor.

     Machines within the Condor pool will need
     various types of access permission. 
     The three categories of permission are read, write,
     and administrator. Enter the machines to be given
     access permissions.

     \begin{description}
     \item[Read]
     Read access allows a machine to obtain information about
     Condor such as the status of machines in the pool and the
     job queues.
     All machines in the pool should be given read access. 
     In addition, giving read access to *.cs.wisc.edu 
     will allow the Condor team to obtain information about
     your Condor pool in the event that debugging is needed.
     \item[Write]
     All machines in the pool should be given write access. 
     It allows the machines you specify to send information to your
	 local Condor daemons, for example, to start a Condor Job.
     Note that for a machine to join the Condor pool, it must have both read and write access to all of the machines in the pool.
     \item[Administrator]
     A machine with administrator access will be allowed more
     extended permission to to things such as
     change other user's priorities, modify the job queue,
     turn Condor services on and off,
     and restart Condor.
     The central manager should be given administrator access
     and is the default listed.
	 This setting is granted to the entire machine, so care should be taken not to make this too open.
     \end{description}

	 For more details on these access permissions, and others that can be
	 manually changed in your \File{condor\_config} file, please
	 see the section titled Setting Up IP/Host-Based Security in Condor
	 in section
	 section~\ref{sec:Host-Security}
	 on page~\pageref{sec:Host-Security}.

\item[STEP 9: Job Start Policy.]
     Condor will execute submitted jobs on machines based on
     a preference given at installation.
     Three options are given, and the first is most commonly used
     by Condor pools.
     This specification may be changed or refined in
     the machine ClassAd requirements attribute.

     The three choices:
     \begin{description}
     \item[After 15 minutes of no console activity and low CPU activity.]
     \item[Always run Condor jobs.]
     \item[After 15 minutes of no console activity.]
     \end{description}

\index{Console activity}
     Console activity is the use of the mouse or keyboard.  For instance,
	 if you are reading this document online, and are using either the
	 mouse or the keyboard to change your position, you are generating
	 Console activity.

\index{CPU activity}
     Low CPU activity is defined as a load of less than 30\Percent
	 (and is configurable in your \File{condor\_config} file).  If you have
	 a multiple processor machine, this is the average percentage of
	 CPU activity for both processors.

	For testing purposes, it is often helpful to use use the Always run Condor
	jobs option.  For production mode, however, most people chose the
	After 15 minutes of no console activity and low CPU activity.

\item[STEP 10: Job Vacate Policy.]
     This step is omitted if Condor jobs are always run as
     the option chosen in STEP 9.

     If Condor is executing a job and the user returns,
	 Condor will immediately suspend the job, and after five minutes
	 Condor will decide what to do with the partially completed job.
     There are currently two options for the job.

     \begin{description}
     \item[The job is killed 5 minutes after your return.]
     The job is suspended immediately once there is console activity.
     If the console activity continues, then the job is
     vacated (killed) after 5 minutes. 
     Since this version does not include check-pointing, the job will
     be restarted from the beginning at a later time.
     The job will be placed back into the queue.
     \item[ Suspend job, leaving it in memory.]
     The job is suspended immediately.  At a later time, when the
	 console activity has stopped for ten minutes, the execution of
	 Condor job will be resumed (the job will be unsuspended).
	 The drawback to this option is that since the job will remain
	 in memory, it will occupy swap space.  In many instances, however,
	 the amount of swap space that the job will occupy is small.
     \end{description}

%    Advice on which to choose goes here.
     So which one do you choose?  Killing a job is less intrusive
	 on the workstation owner than leaving it in memory for a later time.
     A suspended job left in memory will require swap space,
     which could possibly be a scarce resource.
     Leaving a job in memory, however, has the benefit that accumulated
     run time is not lost for a partially completed job.

\item[STEP 11: Review entered information.]
     Check that the entered information is correctly entered.
     You have the option to return to previous dialog boxes to fix entries.
\end{description}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{\label{sec:nt-unattended-install-procedure}
Unattended Installation Procedure using the included Set Up Program}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{Windows!installation!unattended install}
This section details how to run the Condor for Windows installer in an
unattended batch mode, i.e. completely from the command prompt without the
GUI interface.

Currently, the Condor for Windows installer is based upon InstallShield's
Package for the Web (PFTW) technology.  So say you download the
\index{Windows!installation!InstallShield} \index{PFTW}
self-extracting \File{.exe} file from the Condor web site, for example
\File{condor-6.7.10-winnt50-x86.exe}.

Then, to automate the installation of a PFTW package, you
would first perform one installation as administrator ``by hand" via the GUI
to create an answer file:
\index{Windows!installation!answer file}

\begin{verbatim}
  condor-6.7.10-winnt50-x86.exe /a /r /f1c:\temp\foo.iss
\end{verbatim}

In this example, the answer file is \verb@c:\temp\foo.iss@.  You can
provide whatever file name you want, but notice there is no space between
the \Opt{/f1} option and the file name.

Next, to install the package completely silently using the same answers you
provided above, you would run as administrator:

\begin{verbatim}
  start /wait condor-6.7.10-winnt50-x86.exe /s /a /s /sms /f1c:\temp\foo.iss
\end{verbatim}

The first \Opt{/s} is only needed for a completely silent installation. If
you leave it off, the PFTW package will show you a status bar as it extracts
the InstallShield tree to the temporary directory.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{\label{sec:NT-Manual-Install}Manual Installation Condor on Windows}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{Windows!manual install}
If you are to install Condor on many different machines, you may wish
to use some other mechanism to install Condor on additional machines
rather than running the Setup program described above on each machine.

\Warn This is for advanced users only!  All others should use the Setup program described above. 

Here is a brief overview of how to install Condor manually without using the provided GUI-based setup program:

\begin{description}
\item [The Service]
The service that Condor will install is called "Condor".  The Startup
Type is Automatic.  The service should log on as System Account, but
\Bold{do not enable} "Allow Service to Interact with Desktop".  The
program that is run is \Condor{master.exe}.

For your convenience, we have included a file called \File{install.exe} in 
the bin directory that will install a service.  It is typically called in the
following way:
\begin{verbatim}
install Condor Condor c:\condor\bin\condor_master.exe
\end{verbatim}

If you wish to remove the service, we have provided a file called
\File{remove.exe}.  To use it, call it in the following way:
\begin{verbatim}
remove Condor
\end{verbatim}

\item [The Registry]
Condor uses a few registry entries in its operation.  The key that Condor
uses is HKEY\_LOCAL\_MACHINE/Software/Condor.  The values that Condor puts
in this registry key serve two purposes.
\begin{enumerate}
\item The values of CONDOR\_CONFIG and RELEASE\_DIR are used for Condor
to start its service.

CONDOR\_CONFIG should point to the \File{condor\_config} file.  In this version
of Condor, it \Bold{must} reside on the local disk.

RELEASE\_DIR should point to the directory where Condor is installed.  This
is typically \File{C:\Bs Condor}, and again, this \Bold{must} reside on the
local disk.

\item The other purpose is storing the entries from the last installation
so that they can be used for the next one.
\end{enumerate}

\item [The Filesystem]
The files that are needed for Condor to operate are identical to the Unix
version of Condor, except that executable files end in \File{.exe}.  For
example the on Unix one of the files is \File{condor\_master} and on Condor
the corresponding file is \File{condor\_master.exe}.

These files currently must reside on the local disk for a variety of reasons.
Advanced Windows users might be able to put the files on remote resources.
The main concern is twofold.  First, the files must be there when the service
is started.  Second, the files must always be in the same spot (including
drive letter), no matter who is logged into the machine.  

\end{description}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{\label{nt-installed-now-what}
Condor is installed... now what?}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{Windows!starting the Condor service}

After the installation of Condor is completed, the Condor service
must be started.  If you used the GUI-based setup program to install
Condor, the Condor service should already be started.  If you installed
manually, Condor must
be started by hand, or you can simply reboot. \Note The Condor service
will start automatically whenever you reboot your machine.

To start condor by hand:
\begin{enumerate}
\item From the Start menu, choose Settings.
\item From the Settings menu, choose Control Panel.
\item From the Control Panel, choose Services.
\item From Services, choose Condor, and Start.
\end{enumerate}

Or, alternatively you can enter the following command from a command prompt:
\begin{verbatim}
         net start condor
\end{verbatim}

\index{Windows!Condor daemon names}
Run the Task Manager (Control-Shift-Escape) to check that Condor
services are running.  The following tasks should
be running:  
\begin{itemize}
\item \Condor{master.exe}
\item \Condor{negotiator.exe}, if this machine is a central manager.
\item \Condor{collector.exe}, if this machine is a central manager.
\item \Condor{startd.exe}, if you indicated that this Condor node should start jobs
\item \Condor{schedd.exe}, if you indicated that this Condor node should submit jobs
to the Condor pool.
\end{itemize}

Also, you should now be able to open up a new cmd (DOS prompt) window, and
the Condor bin directory should be in your path, so you can issue the normal
Condor commands, such as \condor{q} and \condor{status}.

\index{installation!Windows|)}
\index{Windows!installation|)}

\subsubsection{\label{nt-running-now-what}
Condor is running... now what?}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Once Condor services are running, try building
and submitting some test jobs.  See the \File{README.TXT} file in the
examples directory
for details.
