%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{\label{sec:History-6-7}Development Release Series 6.7}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This is the development release series of Condor,
The details of each version are described below.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\label{sec:New-6-7-2}Version 6.7.2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item None.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item A Condor pool can now support multiple Collectors. This should
  improve stability due to automatic failover. All daemons will now
  send updates to ALL of the specified collectors. All daemons/tools
  will query the Collectors in sequence, until an appropriate 
  response is received. Thus if one (or more) of the Collectors are 
  down, the pool will continue to function normally, as long as 
  there is at least one functioning Collector. 
  You can specify multiple (comma-separated) collector host (and port) 
  addresses in the \Expr{COLLECTOR\_HOST} entry in the configuration
  file. A given \Condor{master} can only run one Collector.

\item When the \Condor{master} is started with the \Opt{-r} option to
  indicate that it should quite after a period of time, the
  \Condor{startd} will now indicate how much time is remaining before it
  exits. It does this by advertising TimeToLive in the machine
  ClassAd.

\item Changed default value of \Macro{CREATE\_CORE\_FILES} macro to
\textsc{TRUE} to enable generation of daemon core files by default.

\item Added new macro \Macro{JOB\_START\_COUNT} that works in
conjunction with existing macro \Macro{JOB\_START\_DELAY} to pace job
starts.  Together, this macro pair provides greater flexibility
tuning job start rate versus available \Condor{schedd} performance.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item When the \Condor{startd} is evaluating the state of each virtual
  machine (VM), it now refreshes any ClassAd attributes which are
  shared from other virtual machines (using \Expr{STARTD\_VM\_EXPRS})
  before it tries to evaluate.
  This way, if a given VM changes its state, all other VMs will
  immediately see this state change.

\item Fixed a bug where you couldn't transfer input files larger than 2 Gigs.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item None.

\end{itemize}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\label{sec:New-6-7-1}Version 6.7.1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item Version 6.7.1 contains all of the features, ports, and bug fixes
  from the previous stable series, up to and including version 6.6.6.
  There are a few additional bugs that have been fixed in the 6.6.x
  stable series which have not yet been released, but which will
  appear in version 6.6.7.
  These bug fixes have been included in version 6.7.1, and appear in
  the ``Bugs fixes included from version 6.6.7'' list below.
  In addition, a number of new features and some bug fixes have been
  made, which are described below in more detail.

\item None.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Added an option to DAGMan's retry ability. If a DAG specifies
  something like ``RETRY job 10 unless-exit 9'', then the retries will
  only happen if the node doesn't exit with a value of 9. 

\item Condor-G can now submit jobs to Globus 3.2 (WS) (for jobs with 
  \Expr{universe = grid}, \Expr{grid\_type = gt3}). Submitting to Globus 
  3.0 (as in Condor 6.7.0) is no longer supported. Submitting to pre-WS 
  Globus (2.x) is still supported (\Expr{grid\_type = gt2}).

\item Added new startd policy expression MaxJobRetirementTime.  This
specifies the maximum amount of time (in seconds) that the startd
is willing to wait for a job to finish on its own when the startd
needs to preempt the job (for owner preemption, negotiator preemption,
or graceful startd shutdown).

\item Added -peaceful shutdown/restart mode.  This will shut down the
startd without killing any jobs, effectively treating both
\Expr{MaxJobRetirementTime} and \Expr{GRACEFUL\_SHUTDOWN\_TIMEOUT} as
infinite.  The default shutdown/restart mode is still -graceful, which
behaves according to whatever \Expr{MaxJobRetirementTime} and
\Expr{GRACEFUL\_SHUTDOWN\_TIMEOUT} are.  The behavior of -fast mode
is unchanged; it kills jobs immediately, regardless of the other
timeout settings.

\item Jobs can now be submitted as ``noop'' jobs. Jobs submitted with
  \Expr{noop\_job = true} will not be executed by Condor, and instead will
   immediately have a terminate event written to the job log file and 
   removed from the queue. This is useful for DAGs where the pre-script
   determines the job should not run.

\item Added preliminary support for the Tool Daemon Protocol (TDP)
  into Condor.
  This protocol is still under development, but the goal is to provide
  a generic way for scheduling systems (daemons) to interact with
  monitoring tools.
  Assuming this protocol is adopted by other scheduling systems and by
  various monitoring tools, it would allow arbitrary combinations of
  tools and schedulers to co-exist, function properly, and provide
  monitoring services for jobs running under the schedulers.
  This initial support allows users to specify a ``tool'' that should
  be spawned along-side their regular Condor job.
  On Linux, the ability to have the batch Condor job suspend
  immediately upon start-up is also implemented, which allows a
  monitoring tool to attach with ptrace() before the job's main()
  function is called.

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a significant memory leak in the \Condor{schedd} that was
  introduced in version 6.7.0.
  In 6.7.0, the \Condor{schedd} would leak a copy of ClassAd for every
  job it tried to spawn (on average, around 2000 bytes per job).

\item Fixed the bugs in Condor's MPI support that were introduced in
  version 6.7.0.
  Condor now supports MPI jobs linked with MPICH 1.2.4 and older.
  Improved Condor's log messages and email notifications when MPI jobs
  run on multiple virtual machines (the messages now include the
  appropriate ``vmX'' identifier, not just the hostname).
  Unfortuately, due to changes in MPICH between version 1.2.4 and
  1.2.5, Condor's MPI support is not compatible with MPICH 1.2.5.
  We will be addressing this problem in a future release.

\end{itemize}

\noindent Bugs fixes included from version 6.6.7:

\begin{itemize}

\item Fixed an important bug in the low-level code that Condor uses to
  transfer files across a network.
  There were certain temporary failure cases that were being treated
  as permanent, fatal errors.
  This resulted in file transfers that aborted prematurely, causing
  jobs to needlessly re-run.
  The code now gracefully recovers from these temporary errors.
  This should significantly help throughput for some sites,
  particularly ones that transfer very large files as output from
  their jobs.

\item Fixed a number of bugs in the \Opt{-format} option to \Condor{q}
  and \Condor{status}.
  Now, these tools will properly handle printing boolean expressions
  in all cases.
  Previously, depending on how the boolean evaluated, either the
  expression was printed, or the tool could crash.
  Furthermore, the tools do a better job of handling the different 
  types of format conversion strings and printing out the appropriate
  value.
  For example, if a user tries to print out a boolean attribute with
  \verb@condor_status -format "%d\n" HasFileTransfer@, the
  \Condor{status} tool will evalute \Attr{HasFiletransfer} and print
  either a 0 or a 1 (FALSE or TRUE).
  If, on the other hand, a user tries to print out a boolean attribute
  with \verb@condor_status -format "%s\n" HasFileTransfer@, the
  \Condor{status} tool will print out the string ``FALSE'' or ``TRUE''
  as appropriate.

\item The ClassAd attribute scope resolution prefixes, \texttt{MY.}
  and \texttt{TARGET.}, are no longer case sensitive.

\item \Condor{dagman} now does better checking for inconsistent events
(such as getting multiple terminate events for a single job).  This
checking can be disabled with the \Opt{-NoEventChecks} command-line
option.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item None.

\end{itemize}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\label{sec:New-6-7-0}Version 6.7.0}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item Version 6.7.0 contains all of the features, ports, and bug fixes
  from the previous stable series, up to and including version 6.6.4.
  In addition, a number of new features and some bug fixes have been
  made, which are described below in more detail.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Added support for vanilla and Java jobs to reconnect when the
  connection between the submitting and execution nodes is lost for
  any reason.
  Possible reasons for this disconnect include: network outages,
  rebooting the submit machine, restarting the Condor daemons on the
  submit machine, etc.
  If the execution machine is rebooted or the Condor daemons are
  restarted, reconnection is not possible.
  To take advantage of this reconnect feature, jobs must be submitted
  with a \Attr{JobLeaseDuration}.
  There are new events in the UserLog related to disconnect and
  reconnect.

\item Added a new Condor tool, \Condor{vacate\_job}.
  This command is similar to \Condor{vacate}, except the kinds of
  arguments it takes define jobs in a job queue, not machines to
  vacate.
  For example, a user can vacate a specific job id, all the jobs in a
  given cluster, all the jobs matching a job queue constraint, or even
  all jobs owned by that user.
  The owner of a job can always vacate their own jobs, regardless of
  the pool security policy controlling \Condor{vacate} (which is an
  administrative command which acts directly on machines).
  See the new command reference, section~\ref{man-condor-vacate-job}
  on page~\pageref{man-condor-vacate-job} for details.
  
\item Added a new ``High Availability'' service to the \Condor{master}.
   You can now specify a daemon which can have ``fail over'' capabilities
   (i.e. the master on another machine can start a matching daemon if the
   first one fails).  Currently, this is only available over a shared
   file system (i.e. NFS), and has only been tested for the \Condor{schedd}.

\item Scheduler universe jobs on UNIX can now specify a
  \Attr{HoldKillSig}, the signal that should be sent when the job is
  put on hold.
  If not specified, the default is to use the \Attr{KillSig}, and if
  that is not defined, the job will be sent a SIGTERM.
  The submit file keyword to use for defining this signal is
  \AdAttr{hold\_kill\_sig}, for example,
  \verb@hold_kill_sig = SIGUSR1@.

\item The \Condor{startd} can now support policies on SMP machines
  where each virtual machine (VM) has knowledge of the other VMs on
  the same host.
  For example, if a job starts running on one of the VMs, a job
  running on another VM could immediately be suspended.
  This is accomplished by using the new configuration variable
  \Macro{STARTD\_VM\_EXPRS}, which is a list of ClassAd attribute
  names that should be shared across all VMs on the machine.
  For each VM on the machine, every attribute in this list is looked
  up in the VM-specific machine ClassAd, the attribute name is given a
  prefix indicating what VM it came from, and then inserted into the
  machine ClassAds of all the other VMs.

\item The \Condor{startd} publishes four new attributes into the
  machine ClassAds it generates when it is in the Claimed state:
  \Attr{TotalJobRunTime}, \Attr{TotalJobSuspendTime},
  \Attr{TotalClaimRunTime}, \Attr{TotalClaimSuspendTime}.
  These attributes keep track of the total time the resource was
  either running a job (in the Busy activity) or had a job suspended,
  regardless of how many suspend/resume cycles the job went through.
  The first two attributes (with ``Job'' in the name) keep track for a
  single job (i.e. since the last time the resource was
  Claimed/Idle). 
  The last two attributes (with ``Claim'' in the name) keep track of
  these totals across all jobs that ran under the same claim
  (i.e. since the last state change into the Claimed state).

\item Added a \Opt{-num} option to the \Condor{wait} tool to wait for
   a specified number of jobs to finish.

\item Added a configuration option \Macro{STARTER\_JOB\_ENVIRONMENT}
   so the admin can configure the default environment inherited by
   user jobs.

\item Added a (configurable, defaults to off) feature to the \Condor{schedd}
   to allow backup the spool file before doing anything else.

\item The "Continous" option of the \Condor{startd} ``cron'' jobs is
being deprecated.   It's being replaced by two new options which
control separate aspects of it's behaviour:
\begin{itemize}
\item "WaitForExit" specifies the "exit timing" mode
\item "ReConfig" specifies that the job can handle SIGHUPs, and it should 
be sent a SIGHUP when the \Condor{startd} is reconfigured.
\end{itemize}

\item A lot of the items logged by the \Condor{startd} ``cron'' logic,
changed to D\_FULLDEBUG (from D\_ALWAYS), etc.

\item Added \Macro{NEGOTIATOR\_PRE\_JOB\_RANK} and
\Macro{NEGOTIATOR\_POST\_JOB\_RANK}.  These expressions are applied
respectively before and after the user-supplied job rank when deciding
which of the possible matches to choose.  (The existing expression
\Macro{PREEMPTION\_RANK} is applied after
\Macro{NEGOTIATOR\_POST\_JOB\_RANK}.)  The pool administrator may use
these expressions to steer jobs in ways that improve the overall
performance of the pool.  For example, using the pre job rank,
preemption may be avoided as long as there are idle machines, even
when the user-supplied rank expression prefers a machine that happens
to be busy.  Using the post job rank, one could steer jobs towards
machines that are known to be dedicated to batch jobs, or one could
enforce breadth-first instead of depth-first filling of a cluster of
multi-processor machines.

\item Added the ability for Condor to transfer files larger than 2G on
platforms that support large files.  This works automatically for
transferred executables, input files and output files.

\item Added the ability for jobs to stream back standard input, output, and
error files while running.  This is activated by the \Opt{stream\_input},
\Opt{stream\_output}, and \Opt{stream\_error} options to \Condor{submit}.
Note that this feature is incompatible with the new feature described
above where the shadow and starter can reconnect in certain
circumstances. 

\item Added support for vanilla jobs to be mirrored on a second
  \Condor{schedd}. The jobs are submitted to the second \Condor{schedd}
  on hold and will be released if the second \Condor{schedd} hasn't
  heard from the first \Condor{schedd} (actually, a \Condor{gridmanager}
  running under the first \Condor{schedd}) for a configurable amount of
  time. Once the second \Condor{schedd} releases the jobs, the first
  \Condor{schedd} acts as a mirror, reflecting the state of the jobs on
  the second \Condor{schedd}.
  To use this mirroring feature, jobs must be submitted
  with a \Attr{mirror\_schedd} parameter in the submit file and require
  no file transfer.

\end{itemize}


\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a bug in the \Condor{startd} ``cron'' logic which caused the
\Condor{startd} to except when trying to delete a job that could never
be run (i.e. invalid executable, etc).

\item Fixed a bug in \Condor{startd} ``cron'' logic which caused it to
not detect when the starting of a ``job'' failed.

\item Fixed several bugs in the reconfiguration handling of the
\Condor{startd} ``cron'' logic.  In particular, even if the job has
the "reconfig" option set (or "continuous"), the job(s) won't be sent
a SIGHUP when the startd first starts, or when the job itself is first
run (until it outputs its first output block, defined by the "-"
separator).

\end{itemize}


\noindent Known Bugs:

\begin{itemize}

\item Condor's MPI support (for MPICH 1.2.4) was broken by other
  changes in version 6.7.0.
  Support for MPI jobs will return in Condor version 6.7.1.

\end{itemize}
\begin{center}
\begin{table}[hbt]
\begin{tabular}{|ll|} \hline
\emph{Architecture} & \emph{Operating System} \\ \hline \hline
Hewlett Packard PA-RISC (both PA7000 and PA8000 series) & HPUX 10.20 \\ \hline
Sun SPARC Sun4m,Sun4c, Sun UltraSPARC & Solaris 2.6, 2.7, 8, 9 \\ \hline
Silicon Graphics MIPS (R5000, R8000, R10000) & IRIX 6.5 (clipped) \\ \hline
Intel x86 & Red Hat Linux 7.1, 7.2, 7.3, 8.0 \\
 & Red Hat Linux 9 \\
 & Windows 2000 Professional and Server, 2003 Server (clipped) \\
 & Windows XP Professional (clipped) \\ \hline
ALPHA & Digital Unix 4.0 \\
 & Red Hat Linux 7.1, 7.2, 7.3 (clipped) \\
 & Tru64 5.1 (clipped) \\ \hline
PowerPC & Macintosh OS X (clipped) \\
 & AIX 5.2L (clipped) \\ \hline
Itanium & Red Hat Linux 7.1, 7.2, 7.3 (clipped) \\
 & SuSE Linux Enterprise 8.1 (clipped) \\ \hline
\end{tabular}
\caption{\label{supported-platforms}Condor 6.7.0 supported platforms}
\end{table}
\end{center}
